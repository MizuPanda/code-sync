name: Sync .py to .cpp

on:
  push:
    branches: ["main", "master"]

permissions:
  contents: write

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Convert/overwrite .cpp from .py and delete .py
        run: |
          set -e
          shopt -s globstar nullglob

          changed=0

          for f in **/*.py; do
            [ -f "$f" ] || continue
            new="${f%.py}.cpp"

            # Ensure destination directory exists
            mkdir -p "$(dirname "$new")"

            # Overwrite or create the .cpp with the .py contents
            cp "$f" "$new"
            git add "$new"

            # Remove the .py file
            git rm -f "$f" >/dev/null 2>&1 || rm -f "$f"
            changed=1
          done

          if [ "$changed" -eq 0 ]; then
            echo "No .py files to convert."
            exit 0
          fi

      - name: Commit & push (if needed)
        run: |
          if git diff --cached --quiet; then
            echo "No changes to commit."
            exit 0
          fi

          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git commit -m "chore: sync LeetCode solutions to .cpp"
          git push
